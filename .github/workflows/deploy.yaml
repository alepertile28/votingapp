name: Deploy VotingApp

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout código
      uses: actions/checkout@v4

    - name: Instalar Helm (se necessário)
      run: |
        if ! command -v helm >/dev/null; then
          curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
        fi

    - name: Fazer deploy com Helm
      run: |
        helm upgrade --install votingapp /root/votingapp/helm \
          --namespace votingapp-lab 

